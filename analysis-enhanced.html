<!--
    analysis-enhanced.html
    Secci√≥n mejorada de An√°lisis con editor de tablero y maestro
    Permite crear posiciones personalizadas y obtener an√°lisis detallado
-->

<div id="analysisEnhancedContainer" class="analysis-enhanced-wrapper">
    <!-- TAB SELECTOR -->
    <div class="analysis-tabs">
        <button class="tab-btn active" data-tab="analysis">üìä An√°lisis</button>
        <button class="tab-btn" data-tab="editor">‚úèÔ∏è Editor de Tablero</button>
        <button class="tab-btn" data-tab="master">üéì Maestro</button>
        <button class="tab-btn" data-tab="trainer">üìö Entrenar</button>
    </div>

    <!-- TAB 1: AN√ÅLISIS AVANZADO -->
    <div id="analysisTab" class="tab-content active">
        <div class="analysis-layout">
            <!-- Lado izquierdo: Tablero -->
            <div class="analysis-board-section">
                <div class="board-header">
                    <h3>üìä Posici√≥n Actual</h3>
                    <button class="btn-small" id="flipBoard">üîÑ Voltear Tablero</button>
                </div>
                <div id="analysisBoardContainer" class="board-container"></div>
                <div class="board-controls">
                    <input type="text" id="fenInput" placeholder="Pega un FEN aqu√≠..." class="fen-input">
                    <button class="btn-primary" id="loadFen">Cargar FEN</button>
                    <button class="btn-secondary" id="resetBoard">Tablero Inicial</button>
                </div>
            </div>

            <!-- Lado derecho: Informaci√≥n de an√°lisis -->
            <div class="analysis-info-section">
                <!-- Evaluaci√≥n r√°pida -->
                <div class="analysis-card">
                    <h4>‚≠ê Evaluaci√≥n</h4>
                    <div class="eval-display">
                        <div id="evalBar" class="eval-bar"></div>
                        <div id="evalText" class="eval-text">Cargando...</div>
                    </div>
                </div>

                <!-- Apertura (si aplica) -->
                <div class="analysis-card" id="openingCard" style="display:none;">
                    <h4>üéØ Apertura</h4>
                    <div id="openingInfo" class="info-text"></div>
                </div>

                <!-- Mejor movimiento -->
                <div class="analysis-card">
                    <h4>üî• Mejor Movimiento</h4>
                    <div id="bestMoveInfo" class="best-move-display">
                        <div class="move-notation" id="bestMoveNotation">--</div>
                        <div class="move-eval" id="bestMoveEval">--</div>
                    </div>
                </div>

                <!-- Variante principal -->
                <div class="analysis-card">
                    <h4>üìà L√≠nea Principal</h4>
                    <div id="principalVariation" class="pv-display">
                        <div class="pv-moves">Cargando...</div>
                    </div>
                </div>

                <!-- Temas estrat√©gicos -->
                <div class="analysis-card">
                    <h4>‚ôüÔ∏è Temas Estrat√©gicos</h4>
                    <ul id="strategicThemes" class="themes-list">
                        <li>Analizando...</li>
                    </ul>
                </div>

                <!-- Temas t√°cticos -->
                <div class="analysis-card">
                    <h4>‚öîÔ∏è Temas T√°cticos</h4>
                    <ul id="tacticalThemes" class="themes-list">
                        <li>Analizando...</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Panel inferior: Todos los movimientos -->
        <div class="all-moves-section">
            <h4>üìã An√°lisis de Todos los Movimientos</h4>
            <div id="allMovesTable" class="moves-table"></div>
        </div>

        <!-- Panel inferior: Consejos -->
        <div class="advice-section">
            <h4>üí° Consejos del Sistema</h4>
            <div id="advicePanel" class="advice-list">
                <p>Cargando consejos...</p>
            </div>
        </div>
    </div>

    <!-- TAB 2: EDITOR DE TABLERO -->
    <div id="editorTab" class="tab-content">
        <div class="editor-layout">
            <!-- Panel izquierdo: Paleta de piezas -->
            <div class="pieces-palette">
                <h4>üéÆ Piezas (Arrastra o Haz Click)</h4>
                <div class="palette-grid">
                    <!-- Piezas blancas -->
                    <div class="piece-group white">
                        <h5>Blancas</h5>
                        <button class="piece-btn" data-piece="P">‚ôô Pe√≥n</button>
                        <button class="piece-btn" data-piece="N">‚ôò Caballo</button>
                        <button class="piece-btn" data-piece="B">‚ôó Alfil</button>
                        <button class="piece-btn" data-piece="R">‚ôñ Torre</button>
                        <button class="piece-btn" data-piece="Q">‚ôï Dama</button>
                        <button class="piece-btn" data-piece="K">‚ôî Rey</button>
                    </div>

                    <!-- Piezas negras -->
                    <div class="piece-group black">
                        <h5>Negras</h5>
                        <button class="piece-btn" data-piece="p">‚ôü Pe√≥n</button>
                        <button class="piece-btn" data-piece="n">‚ôû Caballo</button>
                        <button class="piece-btn" data-piece="b">‚ôù Alfil</button>
                        <button class="piece-btn" data-piece="r">‚ôú Torre</button>
                        <button class="piece-btn" data-piece="q">‚ôõ Dama</button>
                        <button class="piece-btn" data-piece="k">‚ôö Rey</button>
                    </div>

                    <!-- Opciones -->
                    <div class="piece-group options">
                        <h5>Acciones</h5>
                        <button class="piece-btn delete" data-piece="DELETE">üóëÔ∏è Borrar</button>
                        <button class="piece-btn clear-all" id="clearAllPieces">üßπ Limpiar Todo</button>
                    </div>
                </div>
            </div>

            <!-- Panel central: Tablero editor -->
            <div class="editor-board-section">
                <h4>‚úèÔ∏è Posici√≥n Personalizada</h4>
                <div id="editorBoardContainer" class="board-container editor-board"></div>
                <div class="editor-info">
                    <div class="selected-piece" id="selectedPieceInfo">--</div>
                    <div class="instructions" id="editorInstructions">
                        1. Selecciona una pieza de la izquierda<br>
                        2. Haz click en el tablero para colocar<br>
                        3. Click derecho o "Borrar" para eliminar
                    </div>
                </div>
            </div>

            <!-- Panel derecho: Validaci√≥n y exportaci√≥n -->
            <div class="editor-controls">
                <h4>üéØ Validaci√≥n</h4>
                <div id="validationPanel" class="validation-panel">
                    <div class="validation-item">
                        <span class="check">‚úì</span>
                        <span>Rey blanco presente</span>
                    </div>
                    <div class="validation-item">
                        <span class="check">‚úì</span>
                        <span>Rey negro presente</span>
                    </div>
                    <div class="validation-item warning">
                        <span class="check">‚ö†Ô∏è</span>
                        <span>Material desbalanceado</span>
                    </div>
                </div>

                <h4>üì§ Exportar/Importar</h4>
                <div class="export-controls">
                    <textarea id="fenExport" class="fen-export" placeholder="Tu FEN aqu√≠..."></textarea>
                    <button class="btn-primary" id="copyFen">üìã Copiar FEN</button>
                    <button class="btn-secondary" id="importFen">üì• Importar FEN</button>
                </div>

                <h4>üñºÔ∏è Importar Imagen</h4>
                <div class="image-import">
                    <input type="file" id="imageUpload" accept="image/*" class="file-input">
                    <button class="btn-secondary" id="analyzeImage">Analizar Imagen</button>
                    <small>Coloca una foto de un tablero de ajedrez</small>
                </div>

                <h4>‚ñ∂Ô∏è Acciones</h4>
                <div class="action-buttons">
                    <button class="btn-primary full" id="analyzeCustom">üîç Analizar Posici√≥n</button>
                    <button class="btn-secondary full" id="resetEditorBoard">‚Ü∫ Tablero Inicial</button>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 3: MAESTRO INTERACTIVO -->
    <div id="masterTab" class="tab-content">
        <div class="master-layout">
            <!-- Panel superior: Controles -->
            <div class="master-controls">
                <h3>üéì Maestro de Ajedrez - An√°lisis Educativo</h3>
                
                <div class="control-group">
                    <label>Nivel de Complejidad:</label>
                    <select id="complexityLevel">
                        <option value="beginner">üü¢ Principiante</option>
                        <option value="intermediate" selected>üü° Intermedio</option>
                        <option value="advanced">üî¥ Avanzado</option>
                    </select>
                </div>

                <div class="control-group">
                    <button class="btn-primary" id="startMasterAnalysis">Comenzar An√°lisis del Maestro</button>
                    <button class="btn-secondary" id="getMobileResumen">üì± Resumen R√°pido (M√≥vil)</button>
                </div>
            </div>

            <!-- Panel central: Explicaci√≥n del maestro -->
            <div class="master-explanation">
                <div id="masterContent" class="master-text">
                    <p>üëã Bienvenido al An√°lisis del Maestro</p>
                    <p>Carga una posici√≥n o usa el editor de tablero para comenzar. El maestro te explicar√°:</p>
                    <ul>
                        <li>üìä Evaluaci√≥n de la posici√≥n</li>
                        <li>üéØ Aperturas y teor√≠a</li>
                        <li>‚ôüÔ∏è Estrategia recomendada</li>
                        <li>‚öîÔ∏è T√°ctica y combinaciones</li>
                        <li>üí° Consejos pr√°cticos</li>
                        <li>üìö Lecciones para recordar</li>
                    </ul>
                </div>

                <!-- Notas visuales en el tablero -->
                <div class="master-board-notes">
                    <h4>üìç Notas Visuales</h4>
                    <div id="masterBoardContainer" class="board-container"></div>
                    <div class="notes-legend">
                        <div class="note-item"><span class="square green"></span>Cuadrado cr√≠tico</div>
                        <div class="note-item"><span class="square yellow"></span>Puesto avanzado</div>
                        <div class="note-item"><span class="square red"></span>Debilidad</div>
                    </div>
                </div>
            </div>

            <!-- Panel lateral: Opciones -->
            <div class="master-sidebar">
                <h4>üìö Recursos Educativos</h4>
                <div class="resource-list">
                    <button class="resource-btn" id="showOpeningDB">Abrir DB de Aperturas</button>
                    <button class="resource-btn" id="showCommonMistakes">Errores Comunes</button>
                    <button class="resource-btn" id="showTacticalPatterns">Patrones T√°cticos</button>
                    <button class="resource-btn" id="suggestStudyPlan">Plan de Estudio</button>
                </div>

                <h4>üíæ Historial</h4>
                <div id="masterHistory" class="history-list">
                    <p><small>Vac√≠o</small></p>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 4: ENTRENADOR -->
    <div id="trainerTab" class="tab-content">
        <div class="trainer-layout">
            <h3>üìö Entrenar Posiciones</h3>
            
            <div class="trainer-section">
                <h4>üéØ Modo de Entrenamiento</h4>
                <p>Carga una posici√≥n y el sistema te proporciona ejercicios interactivos:</p>
                
                <div class="trainer-options">
                    <button class="trainer-btn">
                        <strong>Encuentra el Mejor Movimiento</strong>
                        <small>¬øCu√°l es el movimiento m√°s fuerte?</small>
                    </button>
                    <button class="trainer-btn">
                        <strong>Analiza la Posici√≥n</strong>
                        <small>¬øBlanca, Negra o Equilibrada?</small>
                    </button>
                    <button class="trainer-btn">
                        <strong>Encuentra T√°cticas</strong>
                        <small>¬øHay jaques, tenedores, etc?</small>
                    </button>
                    <button class="trainer-btn">
                        <strong>Secuencia Forzada</strong>
                        <small>Encuentra la secuencia ganadora</small>
                    </button>
                </div>
            </div>

            <div class="trainer-progress">
                <h4>üìä Tu Progreso</h4>
                <div class="progress-stats">
                    <div class="stat">
                        <div class="stat-label">Ejercicios</div>
                        <div class="stat-value">0/50</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Precisi√≥n</div>
                        <div class="stat-value">--%</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Racha</div>
                        <div class="stat-value">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ESTILOS CSS -->
<style>
.analysis-enhanced-wrapper {
    background: var(--bg-secondary, #1e1e1e);
    border-radius: 8px;
    padding: 20px;
    color: var(--text-primary, #fff);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* TABS */
.analysis-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
}

.tab-btn {
    padding: 10px 20px;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.6);
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
}

.tab-btn.active {
    color: #fff;
    border-bottom-color: #4CAF50;
}

.tab-btn:hover {
    color: #fff;
}

.tab-content {
    display: none;
    animation: fadeIn 0.3s ease;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* LAYOUT AN√ÅLISIS */
.analysis-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

@media (max-width: 1200px) {
    .analysis-layout {
        grid-template-columns: 1fr;
    }
}

/* TABLERO */
.board-container {
    aspect-ratio: 1;
    background: linear-gradient(135deg, #8B7355 0%, #D2B48C 100%);
    border: 3px solid #333;
    border-radius: 8px;
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 0;
    overflow: hidden;
    margin: 10px 0;
    max-width: 400px;
}

.square {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    font-weight: bold;
    user-select: none;
    cursor: pointer;
    transition: all 0.2s ease;
}

.square:nth-child(odd) {
    background: #F0D9B5;
}

.square:nth-child(even) {
    background: #B58863;
}

.square:nth-child(8n+1):nth-child(-8n+8),
.square:nth-child(8n+3):nth-child(-8n+16),
.square:nth-child(8n+5):nth-child(-8n+24),
.square:nth-child(8n+7):nth-child(-8n+32),
.square:nth-child(8n+2):nth-child(-8n+40),
.square:nth-child(8n+4):nth-child(-8n+48),
.square:nth-child(8n+6):nth-child(-8n+56),
.square:nth-child(8n+8):nth-child(-8n+64) {
    background: #B58863;
}

/* AN√ÅLISIS INFO */
.analysis-card {
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.analysis-card h4 {
    margin: 0 0 10px 0;
    font-size: 14px;
    font-weight: 600;
}

.eval-bar {
    height: 30px;
    background: linear-gradient(90deg, #FF6B6B 0%, #FFD93D 50%, #6BCB77 100%);
    border-radius: 4px;
    margin-bottom: 10px;
}

.eval-text {
    font-size: 16px;
    font-weight: bold;
    text-align: center;
}

.best-move-display {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    padding: 10px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.pv-moves {
    font-family: 'Courier New', monospace;
    font-size: 12px;
    padding: 8px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
    line-height: 1.6;
}

.themes-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.themes-list li {
    padding: 5px 0;
    font-size: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

/* EDITOR */
.editor-layout {
    display: grid;
    grid-template-columns: 200px 1fr 250px;
    gap: 20px;
}

@media (max-width: 1024px) {
    .editor-layout {
        grid-template-columns: 1fr;
    }
}

.pieces-palette {
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 6px;
}

.palette-grid {
    display: grid;
    gap: 10px;
}

.piece-group {
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 10px;
    border-radius: 4px;
}

.piece-group h5 {
    margin: 0 0 8px 0;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.piece-btn {
    display: block;
    width: 100%;
    padding: 8px;
    margin: 4px 0;
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid #4CAF50;
    color: #fff;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s ease;
}

.piece-btn:hover {
    background: rgba(76, 175, 80, 0.3);
}

.piece-btn.delete {
    background: rgba(255, 107, 107, 0.1);
    border-color: #FF6B6B;
}

.piece-btn.delete:hover {
    background: rgba(255, 107, 107, 0.3);
}

/* BOTONES */
.btn-primary, .btn-secondary, .btn-small {
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s ease;
    font-size: 13px;
}

.btn-primary {
    background: #4CAF50;
    color: white;
}

.btn-primary:hover {
    background: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}

.btn-secondary {
    background: rgba(76, 175, 80, 0.2);
    border: 1px solid #4CAF50;
    color: #4CAF50;
}

.btn-secondary:hover {
    background: rgba(76, 175, 80, 0.4);
}

.btn-small {
    padding: 6px 12px;
    font-size: 11px;
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
}

.btn-small:hover {
    background: rgba(255, 255, 255, 0.2);
}

.btn-primary.full {
    width: 100%;
    margin-bottom: 8px;
}

/* MASTER */
.master-layout {
    display: grid;
    grid-template-columns: 1fr 1fr 250px;
    gap: 20px;
}

@media (max-width: 1024px) {
    .master-layout {
        grid-template-columns: 1fr;
    }
}

.master-text {
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 6px;
    line-height: 1.8;
    font-size: 13px;
}

.master-text p {
    margin: 8px 0;
}

.master-text ul {
    margin: 10px 0;
    padding-left: 20px;
}

.master-text li {
    margin: 4px 0;
}

/* FEN INPUT */
.fen-input, .fen-export {
    width: 100%;
    padding: 10px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #fff;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 11px;
    margin: 5px 0;
}

.fen-export {
    min-height: 80px;
    resize: vertical;
}

.export-controls {
    margin-top: 10px;
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .analysis-tabs {
        flex-wrap: wrap;
    }

    .tab-btn {
        flex: 1;
        min-width: 80px;
    }

    .analysis-board-section {
        margin-bottom: 20px;
    }

    .board-container {
        max-width: 100%;
    }
}
</style>
